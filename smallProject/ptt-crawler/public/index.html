<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ptt-crawler</title>
    <style>
        body {
            text-align: center;
        }
        button {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>爬PTT</h1>
    看板:
    <select id="kanban">
        <option value="Gossiping">綜合</option>
        <option value="Baseball">棒球</option>
    </select>
    日期:<input type="date" name="date" id="date"><br>
    目標:<input type="text" name="target" id="target">
    <button onclick="sendReq()">開💩爬文</button>
    <div id="container"></div>
<script>
    const host = "http://127.0.0.1:8080/"
    async function sendReq() {
        const data = await getData()
        const res = await fetch((host + 'api/getResult'), {
            method: 'POST',
            body: data,
            headers: {
                'Content-Type':'application/json'
            }
        })
        const myJson = await res.json()
        if (res.status == 200) {
            container = document.getElementById("container")
            container.innerHTML = myJson.data
            alert(myJson.data)
            return
        }
        else {
            alert("錯誤的請求") 
            window.location.href = host
        }
    }
    function getData() {
        kanban = String(document.getElementById("kanban").value)
        date = String(document.getElementById("date").value)
        target =   String(document.getElementById("target").value) 
        ret = {
            "kanban": kanban,
            "date": date,
            "target": target
        }
        return JSON.stringify(ret)
    }
    //
    function testFunc() {
        kanban = String(document.getElementById("kanban").value)
        date = String(document.getElementById("date").value)
        target =   String(document.getElementById("target").value) 
        alert(kanban + typeof(kanban))
        alert(date + typeof(date))
        alert(target + typeof(target))
        return    
    }
</script>
</body>
</html>